<?php/* * **************************************** *     _____                     *    |  __ \                    *    | |  | |_   _  ___  _ __   *    | |  | | | | |/ _ \| '_ \  *    | |__| | |_| | (_) | | | | *    |_____/ \__, |\___/|_| |_| *             __/ |             *            |___/   *            *       Paulo Felipe Possa Parrira [ paul (dot) 0 (at) live (dot) de ] *  ===================================================================== *  File: main.php *  Type: Controller *  *  ===================================================================== *  Classe para verificar quais as medidas devem ser tomadas ao visitar a página inicial do Dyon. *  ===================================================================== *  Lista de erros da classe: *  */require_once("includes/lib/Twig/Autoloader.php");require_once("includes/control/usuario/users.php");require_once("includes/control/board/board.php");class main {    private $twig_loader;    private $twig;    /**     * Inicializa a classe e verifica os parâmetros passados via URL, também verifica se o usuário está logado e quais são suas permissões.     * @param Array $url     */    public function init($url) {        Twig_Autoloader::register();        $this->twig_loader = new Twig_Loader_Filesystem('includes/interface/templates/manager');        $this->twig = new Twig_Environment($this->twig_loader);        $this->usercontroller = new userController();        // Verifica se o usuário está logado        if ($this->usercontroller->authUser()) {            try {                $user = $this->usercontroller->getUser(5);            } catch (Exception $error) {                $login_error_flag = true;                echo $this->twig->render("main_login.twig", Array("config" => config::$html_preload, "login_error_flag" => $login_error_flag));                return;            }            $boardcontroller = new boardController();            $boardcontroller->init($url);        } else {            $login_error_flag = false;            if (isset($_POST['login'])) {                try {                    $this->usercontroller->loginUser($_POST['login']['email'], $_POST['login']['senha']);                    try {                        $this->usercontroller->getUser();                    } catch (Exception $error) {                        $this->usercontroller->logoutUser();                        throw new Exception("Permissão inválida.");                    }                    $this->init($url);                    return;                } catch (Exception $error) {                    $login_error_flag = true;                    echo $error->getMessage();                }            }            echo $this->twig->render("main_login.twig", Array("config" => config::$html_preload, "login_error_flag" => $login_error_flag));        }    }}function init_module_index($url = Array()) {    $main = new main();    $main->init($url);}